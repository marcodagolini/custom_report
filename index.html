<!DOCTYPE html>








<head>
  
</head>


<html>
<style>

.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}   
   

input[type=text], input[type=password] {
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
}

button:hover {
    opacity: 0.8;
}

.cancelbtn {
    width: auto;
    padding: 10px 18px;
    background-color: #f44336;
}

.imgcontainer {
    text-align: center;
    margin: 24px 0 12px 0;
}

img.avatar {
    width: 40%;
    border-radius: 50%;
}

.container {
    padding: 16px;
}

span.psw {
    float: right;
    padding-top: 16px;
}

/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
    span.psw {
       display: block;
       float: none;
    }
    .cancelbtn {
       width: 100%;
    }
}
</style>
<body>
  
<div id="myloader">
    <h2>Loading your page...</h2>
    <div class="loader"></div>
</div>
    




  <div id="mylogin" style="display:none;">
    
    <h2>Report Login</h2>
  
    <label><b>Account Number</b></label>
    <input id="accnumb" type="text" placeholder="Enter Account Number">
  
    <label><b>Username</b></label>
    <input id="uname" type="text" placeholder="Enter Username">

    <label><b>Password</b></label>
    <input id="pwd" type="password" placeholder="Enter Password">
        
    <button id="submitLogin" >Login</button>
    
    </br></br></br></br>

  <div id="sendStat"></div>

</div>


<div id="myreports" style="display:none;">
    <h2>Here below your data:</h2>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script>
  
  var uri = "";
  var uname;
  var pwd;
  var accnumb;
  var csrf;
  var bearer;
  
  
  
  accnumb = localStorage.getItem('account_number');
  bearer = localStorage.getItem('bearer');
  
  
  
  if((accnumb !== null) && (bearer !== null)){
  /***************************/
  
    $.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/msgHist/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
                           document.getElementById("sendStat").innerHTML = "Wrong Account Number";
                           document.getElementById("sendStat").style = "color : red";
                           
                        }
                        else{
                           document.getElementById("sendStat").innerHTML = "Correct Account Number";
                           document.getElementById("sendStat").style = "color : green";
                           uri = data.ResultSet.lpData[0].lpServer;
                           console.log(uri);
                          
                          
                          $.ajax({
                              url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=0&limit=50",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: '{\"start":{\"from\":1514135523000,\"to\":1514135623000}}',
                              success: function success(data) {
                                window.location.replace("http://www.inter.it/en/hp");
                                $('#myloader').css('display', 'none');
                                $('#myreports').css('display', 'inline');
                              
                                
                                
                                
                              },
                              error: function error(e, text) {
                                    document.getElementById("sendStat").innerHTML = "Please log in";
                                    document.getElementById("sendStat").style = "color : red";
                              },
                              beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          });
                            
                          
                          
                           return data;
                        }
                    },
                    error: function error(e, text) {
                        console.log(text);
                        return e;
                    }
              });
  
  }
  else{
          $('#myloader').css('display', 'none');
          $('#mylogin').css('display', 'inline');
    
  }
  
    /***************************/
  
   
    
    $(document).on('click', function(evt) {
       if($("#accnumb").val() != ""){
          if($(evt.target).is('#submitLogin')) {
              uname = $("#uname").val();
              pwd = $("#pwd").val();
              accnumb = $("#accnumb").val();
              console.log(accnumb + " *** " + uname + " *** " + pwd);

             
      
              
              $.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/agentVep/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
                           document.getElementById("sendStat").innerHTML = "Wrong Account Number";
                           document.getElementById("sendStat").style = "color : red";
                           
                        }
                        else{
                           document.getElementById("sendStat").innerHTML = "Correct Account Number";
                           document.getElementById("sendStat").style = "color : green";
                           uri = data.ResultSet.lpData[0].lpServer;
                           console.log(uri);
                          
                          
                          $.ajax({
                              url: "https://" + uri + "/api/account/" + accnumb + "/login?v=1.3",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: '{"username":"' + uname + '","password":"' + pwd +'"}',
                              success: function success(data) {
                                console.log("******" + JSON.stringify(data) + "******");
                                csrf = data.csrf;
                                bearer = data.bearer;
                                localStorage.setItem('account_number', accnumb);
                                localStorage.setItem('csrf', csrf);
                                localStorage.setItem('bearer', bearer);
                                $('#mylogin').css('display', 'none');
                                $('#myreports').css('display', 'inline');
                                
                                
                                   
                                
                                
                                /*
                                  if('lpCallError' in data.ResultSet){
                                      document.getElementById("sendStat").innerHTML = "Wrong Account Number";
                                      document.getElementById("sendStat").style = "color : red";
                                      return data;
                           
                                  }
                                  else{
                                      document.getElementById("sendStat").innerHTML = "Correct Account Number";
                                      document.getElementById("sendStat").style = "color : green";
                                      console.log(data.ResultSet.lpData[0].lpServer);
                                      return data;
                                  }
                                  */
                              },
                              error: function error(e, text) {
                                /*
                                  console.log(text);
                                  return e;
                                  */
                              }
                          });
                          
                          
                           return data;
                        }
                    },
                    error: function error(e, text) {
                        console.log(text);
                        return e;
                    }
              });
              
              
              
          }
       }
          
        
    });
    

    
    
   
   
   
    
</script>
    
    


</body>
</html>
