<!DOCTYPE html>





<head>
  
</head>


<html>
<style>
	
	
body{
  margin: 10px;	
}
.version{
	text-align: right;
	padding: 3px;
	font-size: 10px;
}
.grid-container-header {
  display: grid;
  grid-template-columns: 200px 100px 100px 100px 100px 100px 100px 100px 100px;
  width: 1000px;
  background-color: #2196F3;
  padding: 0px;
}
.grid-bright {
  display: grid;
  grid-template-columns: 300px 100px 100px 100px 100px 100px 100px 100px;
  width: 1000px;
  background-color: #ebf3fb;
  padding: 0px;
}
.grid-dark {
  display: grid;
  grid-template-columns: 300px 100px 100px 100px 100px 100px 100px 100px;
  width: 1000px;
  background-color: #c1c1c1;
  padding: 0px;
}
.grid-tot {
  display: grid;
  grid-template-columns: 300px 100px 100px 100px 100px 100px 100px 100px;
  width: 1000px;
  background-color: #79b178;
  padding: 0px;
}
.grid-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: center;
}
.grid-item-left {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: right;
}
	
.grid-title-left {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: left;
  color: red;
}
	
.bar-container {
  display: grid;
  grid-template-columns: auto auto auto auto;
  background-color: #2196F3;
  padding: 5px;
}
.bar-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: center;
}
.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}
	
/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}   
  
input[type=text], input[type=password] {
    width: 200px;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
}
button {
    background-color: #f68a1f;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 4px;
    cursor: pointer;
	  border-radius: 4px;
	  -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;
}
button:hover {
    background-color: #da7009;
    color: white;	
}
	
button:disabled,
button[disabled]{
  background-color: #f68a1f;
  opacity: 0.5;
}
	
.cancelbtn {
    width: auto;
    padding: 10px 18px;
    background-color: #f44336;
}
.imgcontainer {
    text-align: center;
    margin: 24px 0 12px 0;
}
img.avatar {
    width: 40%;
    border-radius: 50%;
}
	
.label {
    color: black;
    width: 120px;
    height: 50px;
    padding: 6px;
    display: block;
    float:left;
    vertical-align: middle;
}
	
.loginelement {
    width: 130px;
    height: 50px;
    vertical-align: middle;
    line-height: 50px;
    float: left;
}
.container {
    padding: 16px;
}
span.psw {
    float: right;
    padding-top: 16px;
}
/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
    span.psw {
       display: block;
       float: none;
    }
    .cancelbtn {
       width: 100%;
    }
}
</style>
<body>
  
  <div id="myloader" style="display:none;">
    	<h2>Loading your page...</h2>
    	<div class="loader"></div>
  </div>
    




  <div id="mylogin" style="display:none;">
    
    <h2>Report Login</h2>
        <div class="loginelement"><b>Account Number</b></div>
	<input id="accnumb" type="text" placeholder="Enter Account Number">
	</br>
	
	<div class="loginelement"><b>Username</b></div>
        <input id="uname" type="text" placeholder="Enter Username">
	</br>
        
	<div class="loginelement"><b>Password</b></div>
        <input id="pwd" type="password" placeholder="Enter Password">
	</br>
        
    <button id="submitLogin" >Login</button>
    
    </br></br></br></br>

  <div id="sendStat"></div>

</div>


<div id="myreports" style="display:none;">
	
    
    </br>
    <div id="version" class="version">v1.1.12</div>
    <button type="button" id ="logout" class="logout" style="float: right;">Log Out</button>

    <div class="bar-container" style="display:none;">
  	<div class="bar-item">open</div>
  	<div class="bar-item">pending</div>
  	<div class="bar-item">unassigned</div>
	<div class="bar-item">limbo</div>
  	<div class="bar-item">overdue</div>
  	<div class="bar-item">soon overdue</div>
  	<div id="open" class="bar-item"></div>  
  	<div id="pending" class="bar-item"></div>
  	<div id="unassigned" class="bar-item"></div>
	<div id="limbo" class="bar-item"></div>
  	<div id="overdue" class="bar-item"></div> 
  	<div id="soonOverdue" class="bar-item"></div>
    </div>

	</br></br>
    
    <div id="reportHeroku"></div>
    <div id="reportBot"></div>



    <div id="loadingStats">
	    </br></br>
	    <label><b>...loading your stats...</b></label></br></br>
	    <div class="loader"></div>
	    </br></br>
	    <div id="loaderMSG"></div>
	    </br>
    </div>
	
    

    <div id="loadedStats" style="display:none;">
	    </br>


	<button type="button" id ="refresh" class="refresh" style="float: right;">Refresh</button>

	    
	<div class="grid-container-header">
		<div class="grid-title-left">FaceBook PM</div> 
  		<div class="grid-item-left">skill</div>  
  		<div class="grid-item" id="openConv">open</div>
		<div class="grid-item" id="assignedConv">assigned</div>
  		<div class="grid-item" id="unassignedConv">unassigned</div>
		<div class="grid-item" id="onlineAgents">online</div>
		<div class="grid-item" id="awayAgents">away</div>
		<div class="grid-item" id="backsoonAgents">back soon</div>
		<div class="grid-item" id="maxSlots">slots</div>
	</div>
	<div class="grid-bright">
  		<div class="grid-item-left">Facebook_priv</div>
  		<div class="grid-item" id="1089726032openConv"></div>
		<div class="grid-item" id="1089726032assignedConv"></div>
		<div class="grid-item" id="1089726032unassignedConv"></div>
		<div class="grid-item" id="FBPonlineAgents"></div>
		<div class="grid-item" id="FBPawayAgents"></div>
		<div class="grid-item" id="FBPsoonAgents"></div>
		<div class="grid-item" id="FBPslots"></div>
	</div>

	<div class="grid-dark">
  		<div class="grid-item-left">Facebook_risvegliate</div>
  		<div class="grid-item" id="1096374632openConv"></div>
		<div class="grid-item" id="1096374632assignedConv"></div>
		<div class="grid-item" id="1096374632unassignedConv"></div>
		<div class="grid-item" id="FBRonlineAgents"></div>
		<div class="grid-item" id="FBRawayAgents"></div>
		<div class="grid-item" id="FBRsoonAgents"></div>
		<div class="grid-item" id="FBRslots"></div>
	</div>
	
	<div class="grid-bright">
  		<div class="grid-item-left">Facebook_priv_night</div>
  		<div class="grid-item" id="1102673132openConv"></div>
		<div class="grid-item" id="1102673132assignedConv"></div>
		<div class="grid-item" id="1102673132unassignedConv"></div>
		<div class="grid-item" id="FBPNonlineAgents"></div>
		<div class="grid-item" id="FBPNawayAgents"></div>
		<div class="grid-item" id="FBPNsoonAgents"></div>
		<div class="grid-item" id="FBPNslots"></div>
	</div>

	<div class="grid-dark">
  		<div class="grid-item-left">Facebook_priv_night_risvegliate</div>
  		<div class="grid-item" id="1102673332openConv"></div>
		<div class="grid-item" id="1102673332assignedConv"></div>
		<div class="grid-item" id="1102673332unassignedConv"></div>
		<div class="grid-item" id="FBPNRonlineAgents"></div>
		<div class="grid-item" id="FBPNRawayAgents"></div>
		<div class="grid-item" id="FBPNRsoonAgents"></div>
		<div class="grid-item" id="FBPNRslots"></div>
	</div>
	
	<div class="grid-bright">
  		<div class="grid-item-left">Fixed</div>
  		<div class="grid-item" id="1117781232openConv"></div>
		<div class="grid-item" id="1117781232assignedConv"></div>
		<div class="grid-item" id="1117781232unassignedConv"></div>
		<div class="grid-item" id="FIXonlineAgents"></div>
		<div class="grid-item" id="FIXawayAgents"></div>
		<div class="grid-item" id="FIXsoonAgents"></div>
		<div class="grid-item" id="FIXslots"></div>
	</div>
	
	<div class="grid-dark">
  		<div class="grid-item-left">Fixed_risvegliate</div>
  		<div class="grid-item" id="1117781332openConv"></div>
		<div class="grid-item" id="1117781332assignedConv"></div>
		<div class="grid-item" id="1117781332unassignedConv"></div>
		<div class="grid-item" id="FIXRonlineAgents"></div>
		<div class="grid-item" id="FIXRawayAgents"></div>
		<div class="grid-item" id="FIXRsoonAgents"></div>
		<div class="grid-item" id="FIXRslots"></div>
	</div>

	<div class="grid-tot">
  		<div class="grid-item-left">Totale</div>
  		<div class="grid-item" id="TFBopenConv"></div>
		<div class="grid-item" id="TFBassignedConv"></div>
		<div class="grid-item" id="TFBunassignedConv"></div>
		<div class="grid-item" id="TFBonlineAgents"></div>
		<div class="grid-item" id="TFBawayAgents"></div>
		<div class="grid-item" id="TFBsoonAgents"></div>
		<div class="grid-item" id="TFBslots"></div>
	</div></br>

	<div class="grid-container-header">
		<div class="grid-title-left">Chat Web</div> 
  		<div class="grid-item-left">skill</div>  
  		<div class="grid-item" id="openConv">open</div>
		<div class="grid-item" id="assignedConv">assigned</div>
  		<div class="grid-item" id="unassignedConv">unassigned</div>
		<div class="grid-item" id="onlineAgents">online</div>
		<div class="grid-item" id="awayAgents">away</div>
		<div class="grid-item" id="backsoonAgents">back soon</div>
		<div class="grid-item" id="maxSlots">slots</div>
	</div>
	
	<div class="grid-bright">
  		<div class="grid-item-left">Human</div>
  		<div class="grid-item" id="987637232openConv"></div>
		<div class="grid-item" id="987637232assignedConv"></div>
		<div class="grid-item" id="987637232unassignedConv"></div>
		<div class="grid-item" id="HonlineAgents"></div>
		<div class="grid-item" id="HawayAgents"></div>
		<div class="grid-item" id="HsoonAgents"></div>
		<div class="grid-item" id="Hslots"></div>
	</div>

	<div class="grid-dark">
  		<div class="grid-item-left">Human_risvegliate</div>
  		<div class="grid-item" id="1096374432openConv"></div>
		<div class="grid-item" id="1096374432assignedConv"></div>
		<div class="grid-item" id="1096374432unassignedConv"></div>
		<div class="grid-item" id="HRonlineAgents"></div>
		<div class="grid-item" id="HRawayAgents"></div>
		<div class="grid-item" id="HRsoonAgents"></div>
		<div class="grid-item" id="HRslots"></div>
	</div>

	<div class="grid-bright">
  		<div class="grid-item-left">Human_night</div>
  		<div class="grid-item" id="1105369932openConv"></div>
		<div class="grid-item" id="1105369932assignedConv"></div>
		<div class="grid-item" id="1105369932unassignedConv"></div>
		<div class="grid-item" id="HNonlineAgents"></div>
		<div class="grid-item" id="HNawayAgents"></div>
		<div class="grid-item" id="HNsoonAgents"></div>
		<div class="grid-item" id="HNslots"></div>
	</div>

	<div class="grid-dark">
  		<div class="grid-item-left">Human_night_risvegliate</div>
  		<div class="grid-item" id="1105551632openConv"></div>
		<div class="grid-item" id="1105551632assignedConv"></div>
		<div class="grid-item" id="1105551632unassignedConv"></div>
		<div class="grid-item" id="HNRonlineAgents"></div>
		<div class="grid-item" id="HNRawayAgents"></div>
		<div class="grid-item" id="HNRsoonAgents"></div>
		<div class="grid-item" id="HNRslots"></div>
	</div>

	<div class="grid-tot">
  		<div class="grid-item-left">Totale</div>
  		<div class="grid-item" id="TWebopenConv"></div>
		<div class="grid-item" id="TWebassignedConv"></div>
		<div class="grid-item" id="TWebunassignedConv"></div>
		<div class="grid-item" id="TWebonlineAgents"></div>
		<div class="grid-item" id="TWebawayAgents"></div>
		<div class="grid-item" id="TWebsoonAgents"></div>
		<div class="grid-item" id="TWebslots"></div>
	</div></br>

	<div class="grid-container-header">
		<div class="grid-title-left">Outbound</div> 
  		<div class="grid-item-left">skill</div>  
  		<div class="grid-item" id="openConv">open</div>
		<div class="grid-item" id="assignedConv">assigned</div>
  		<div class="grid-item" id="unassignedConv">unassigned</div>
		<div class="grid-item" id="onlineAgents">online</div>
		<div class="grid-item" id="awayAgents">away</div>
		<div class="grid-item" id="backsoonAgents">back soon</div>
		<div class="grid-item" id="maxSlots">slots</div>
	</div>

	<div class="grid-bright">
  		<div class="grid-item-left">Outbound</div>
  		<div class="grid-item" id="1093097632openConv"></div>
		<div class="grid-item" id="1093097632assignedConv"></div>
		<div class="grid-item" id="1093097632unassignedConv"></div>
		<div class="grid-item" id="OonlineAgents"></div>
		<div class="grid-item" id="OawayAgents"></div>
		<div class="grid-item" id="OsoonAgents"></div>
		<div class="grid-item" id="Oslots"></div>
	</div>

	<div class="grid-dark">
  		<div class="grid-item-left">Outbound_risvegliate</div>
  		<div class="grid-item" id="1096374732openConv"></div>
		<div class="grid-item" id="1096374732assignedConv"></div>
		<div class="grid-item" id="1096374732unassignedConv"></div>
		<div class="grid-item" id="ORonlineAgents"></div>
		<div class="grid-item" id="ORawayAgents"></div>
		<div class="grid-item" id="ORsoonAgents"></div>
		<div class="grid-item" id="ORslots"></div>
	</div>

	<div class="grid-bright">
  		<div class="grid-item-left">Outbound_fixed</div>
  		<div class="grid-item" id="1105849832openConv"></div>
		<div class="grid-item" id="1105849832assignedConv"></div>
		<div class="grid-item" id="1105849832unassignedConv"></div>
		<div class="grid-item" id="OFonlineAgents"></div>
		<div class="grid-item" id="OFawayAgents"></div>
		<div class="grid-item" id="OFsoonAgents"></div>
		<div class="grid-item" id="OFslots"></div>
	</div>

	<div class="grid-dark">
  		<div class="grid-item-left">Outbound_fixed_risvegliate</div>
  		<div class="grid-item" id="1105849932openConv"></div>
		<div class="grid-item" id="1105849932assignedConv"></div>
		<div class="grid-item" id="1105849932unassignedConv"></div>
		<div class="grid-item" id="OFRonlineAgents"></div>
		<div class="grid-item" id="OFRawayAgents"></div>
		<div class="grid-item" id="OFRsoonAgents"></div>
		<div class="grid-item" id="OFRslots"></div>
	</div>

	<div class="grid-tot">
  		<div class="grid-item-left">Totale</div>
  		<div class="grid-item" id="TOopenConv"></div>
		<div class="grid-item" id="TOassignedConv"></div>
		<div class="grid-item" id="TOunassignedConv"></div>
		<div class="grid-item" id="TOonlineAgents"></div>
		<div class="grid-item" id="TOawayAgents"></div>
		<div class="grid-item" id="TOsoonAgents"></div>
		<div class="grid-item" id="TOslots"></div>
	</div></br>

	<div class="grid-container-header">
		<div class="grid-title-left">Other</div> 
  		<div class="grid-item-left">skill</div>  
  		<div class="grid-item" id="openConv">open</div>
		<div class="grid-item" id="assignedConv">assigned</div>
  		<div class="grid-item" id="unassignedConv">unassigned</div>
		<div class="grid-item" id="onlineAgents">online</div>
		<div class="grid-item" id="awayAgents">away</div>
		<div class="grid-item" id="backsoonAgents">back soon</div>
		<div class="grid-item" id="maxSlots">slots</div>
	</div>

	<div class="grid-bright">
  		<div class="grid-item-left">Inglese</div>
  		<div class="grid-item" id="1097496532openConv"></div>
		<div class="grid-item" id="1097496532assignedConv"></div>
		<div class="grid-item" id="1097496532unassignedConv"></div>
		<div class="grid-item" id="IonlineAgents"></div>
		<div class="grid-item" id="IawayAgents"></div>
		<div class="grid-item" id="IsoonAgents"></div>
		<div class="grid-item" id="Islots"></div>
	</div>
	<div class="grid-dark">
  		<div class="grid-item-left">Inglese_Chat</div>
  		<div class="grid-item" id="1151792232openConv"></div>
		<div class="grid-item" id="1151792232assignedConv"></div>
		<div class="grid-item" id="1151792232unassignedConv"></div>
		<div class="grid-item" id="IConlineAgents"></div>
		<div class="grid-item" id="ICawayAgents"></div>
		<div class="grid-item" id="ICsoonAgents"></div>
		<div class="grid-item" id="ICslots"></div>
	</div>
	<div class="grid-bright">
  		<div class="grid-item-left">Priority</div>
  		<div class="grid-item" id="1111905932openConv"></div>
		<div class="grid-item" id="1111905932assignedConv"></div>
		<div class="grid-item" id="1111905932unassignedConv"></div>
		<div class="grid-item" id="PonlineAgents"></div>
		<div class="grid-item" id="PawayAgents"></div>
		<div class="grid-item" id="PsoonAgents"></div>
		<div class="grid-item" id="Pslots"></div>
	</div>

	<div class="grid-tot">
  		<div class="grid-item-left">Totale</div>
  		<div class="grid-item" id="TOtheropenConv"></div>
		<div class="grid-item" id="TOtherassignedConv"></div>
		<div class="grid-item" id="TOtherunassignedConv"></div>
		<div class="grid-item" id="TOtheronlineAgents"></div>
		<div class="grid-item" id="TOtherawayAgents"></div>
		<div class="grid-item" id="TOthersoonAgents"></div>
		<div class="grid-item" id="TOtherslots"></div>
	</div>

	</br>
	<div id="slotsAvailable"></div></br></br>

	<div id="offlineAssignedAgent"></div>

	</br></br></br></br>

    </div>

    </br></br></br>




</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script>
  
  var uri = "";
  var facadeUri = "";
  var accountReadWrite = "";
  var timeZone = "";
  var skillNumber = "-1";
  var teamNumber = 0;
  var skillArray = [];
  var teamArray = [];
  var alberoArray = [];
  var uname;
  var pwd;
  var csrf;
  var accnumb = localStorage.getItem('account_number');
  var bearer = localStorage.getItem('bearer');
  var statisticOptions = 0;
  var customDate;
  var endCustomDate;
  var overwriteHumanSkill = "";
  var FacebookBotID = "1089636032";
  var exportObject = [];
  var agentLogged = [];
  var agentAssigned = [];
  var myFileToXLS = "";
	
  var mySkillsToLoad = ["1089726032","1096374632","1102673132","1102673332","1117781232","1117781332","987637232","1096374432","1105369932","1105551632","1093097632","1096374732","1105849832","1105849932","1097496532","1151792232","1111905932"];
  var mySkillsToLoadLength = mySkillsToLoad.length;
	  
	
  function findBulk(Seconds){
	 if (Seconds <= 30){
		return 1; 
	 }
	  else if (Seconds <= 60){
		return 2;  
	  }
	  else{
		return 3;  
	  }
  }
	
	
  
	
 
	
function herokuOrNot() {
        var xhr = new XMLHttpRequest();
        xhr.addEventListener("readystatechange", function () {
          	if (this.readyState === 4) {
			if (this.status == 200 && xhr.status < 300){
				document.getElementById("reportHeroku").innerHTML = "Il servizio di hosting del bot e' up";
				document.getElementById("reportHeroku").style = "color : green";
				document.getElementById("reportHeroku").style.fontWeight = "bold";
				document.getElementById("reportHeroku").style.fontSize = "large";
			}
			else{
				document.getElementById("reportHeroku").innerHTML = "Il servizio di hosting del bot e' down";
				document.getElementById("reportHeroku").style = "color : red";
				document.getElementById("reportHeroku").style.fontWeight = "bold";
				document.getElementById("reportHeroku").style.fontSize = "large";
			}
          	}
		else {
            		document.getElementById("reportHeroku").innerHTML = "...checking hosting bot status...";
            		document.getElementById("reportHeroku").style = "color : black";
			document.getElementById("reportHeroku").style.fontWeight = "bold";
			document.getElementById("reportHeroku").style.fontSize = "large";
          	}
        });
        var URLforGET = "https://vodafonebotdario.herokuapp.com/ping?ping=true&username=" + localStorage.getItem('username');
	xhr.open("GET", URLforGET);
        xhr.send();
}
	
	
function botOrNot() {
        var xhr = new XMLHttpRequest();
        xhr.addEventListener("readystatechange", function () {
          	if (this.readyState === 4) {
			if (this.status == 200 && xhr.status < 300){
				document.getElementById("reportBot").innerHTML = "Il bot e' connesso";
				document.getElementById("reportBot").style = "color : green";
				document.getElementById("reportBot").style.fontWeight = "bold";
				document.getElementById("reportBot").style.fontSize = "large";
			}
			else{
				document.getElementById("reportBot").innerHTML = "Il bot non e' connesso";
				document.getElementById("reportBot").style = "color : red";
				document.getElementById("reportBot").style.fontWeight = "bold";
				document.getElementById("reportBot").style.fontSize = "large";
			}
          	}
		else {
            		document.getElementById("reportBot").innerHTML = "...checking bot status...";
            		document.getElementById("reportBot").style = "color : black";
			document.getElementById("reportBot").style.fontWeight = "bold";
			document.getElementById("reportBot").style.fontSize = "large";
          	}
        });
        var URLforGET = "https://vodafonebotdario.herokuapp.com/add?retrieve=1&visitorID=0&convID=0";
	xhr.open("GET", URLforGET);
        xhr.send();
}
	
	
	
function retrieveAgentsLogged(){
	
	var FBPonlineAgents = 0;
	var FBPawayAgents = 0;
	var FBPsoonAgents = 0;
	var FBPslots =0;
	var FBRonlineAgents = 0;
	var FBRawayAgents = 0;
	var FBRsoonAgents = 0;
	var FBRslots =0;
	var FBPNonlineAgents = 0;
	var FBPNawayAgents = 0;
	var FBPNsoonAgents = 0;
	var FBPNslots =0;
	var FBPNRonlineAgents = 0;
	var FBPNRawayAgents = 0;
	var FBPNRsoonAgents = 0;
	var FBPNRslots =0;
	var FIXonlineAgents = 0;
	var FIXawayAgents = 0;
	var FIXsoonAgents = 0;
	var FIXslots =0;
	var FIXRonlineAgents = 0;
	var FIXRawayAgents = 0;
	var FIXRsoonAgents = 0;
	var FIXRslots =0;
	var HonlineAgents = 0;
	var HawayAgents = 0;
	var HsoonAgents = 0;
	var Hslots =0;
	var HRonlineAgents = 0;
	var HRawayAgents = 0;
	var HRsoonAgents = 0;
	var HRslots =0;
	var HNonlineAgents = 0;
	var HNawayAgents = 0;
	var HNsoonAgents = 0;
	var HNslots =0;
	var HNRonlineAgents = 0;
	var HNRawayAgents = 0;
	var HNRsoonAgents = 0;
	var HNRslots =0;
	var OonlineAgents = 0;
	var OawayAgents = 0;
	var OsoonAgents = 0;
	var Oslots =0;
	var ORonlineAgents = 0;
	var ORawayAgents = 0;
	var ORsoonAgents = 0;
	var ORslots =0;
	var OFonlineAgents = 0;
	var OFawayAgents = 0;
	var OFsoonAgents = 0;
	var OFslots =0;
	var OFRonlineAgents = 0;
	var OFRawayAgents = 0;
	var OFRsoonAgents = 0;
	var OFRslots =0;
	var IonlineAgents = 0;
	var IawayAgents = 0;
	var IsoonAgents = 0;
	var Islots = 0;
	var IConlineAgents = 0;
	var ICawayAgents = 0;
	var ICsoonAgents = 0;
	var ICslots = 0;
	var PonlineAgents = 0;
	var PawayAgents = 0;
	var PsoonAgents = 0;
	var Pslots = 0;
	var TFBonlineAgents = 0;
	var TWebonlineAgents = 0;
	var TOonlineAgents = 0;
	var TOtheronlineAgents = 0;
	var TFBawayAgents = 0;
	var TWebawayAgents = 0;
	var TOawayAgents = 0;
	var TOtherawayAgents = 0;
	var TFBsoonAgents = 0;
	var TWebsoonAgents = 0;
	var TOsoonAgents = 0;
	var TOthersoonAgents = 0;
	var TFBslots = 0;
	var TWebslots = 0;
	var TOslots = 0;
	var TOtherslots = 0;
	
	var body = '{"skillIds":["1089726032","1096374632","1102673132","1102673332","987637232","1096374432","1105369932","1105551632","1093097632","1096374732","1105849832","1105849932","1097496532","1012134132","1111294132","1111905932","1117781232","1117781332","1151792232"]}';
	var totalSpots = 0;
	var availableSpots = 0;
	
	agentLogged = [];
	
	setTimeout(function(){
		  
		  $.ajax({
			  url: "https://lo.msghist.liveperson.net/messaging_history/api/account/13099967/agent-view/status",
			  method: "POST",
			  jsonp: "cb",
			  jsonpCallback: "domainCallback",
			  cache: true,
			  contentType: "application/json",
			  "If-Match": "-1",
			  data: body,
			  success: function success(data) {
				  // console.log("********");
				  loadAggregate();
				  console.log(JSON.stringify(data));
				  if(data.hasOwnProperty('_metadata')){
					  if(data._metadata.hasOwnProperty('count')){
						  if(data._metadata.count > 0){
							  if(data.hasOwnProperty('agentStatusRecords')){
								  var agentStatusRecordsLength = data.agentStatusRecords.length;
								  for (var z = 0; z < agentStatusRecordsLength; z++){
									  agentLogged.push(data.agentStatusRecords[z].agentName.replace("  ", " "));
									  var FBcounted = false;
									  var Hcounted = false;
									  var Ocounted = false;
									  var Othercounted = false;
									  totalSpots = (data.agentStatusRecords[z].configuredMaxSlots) - (data.agentStatusRecords[z].busySlots);
									  availableSpots = availableSpots + totalSpots;
									  var skillLength = data.agentStatusRecords[z].agentSkills.length;
									  var statusAgent = data.agentStatusRecords[z].currentStatus;
									  for (var m = 0; m < skillLength; m++){
										  if (data.agentStatusRecords[z].agentSkills[m].skillId === "-1"){
											 // do nothing 
										  } else{
											  var currentSkill = data.agentStatusRecords[z].agentSkills[m].skillName;
											  switch(currentSkill) {
													  case "Facebook_priv":
													  switch(statusAgent) {
															  case "ONLINE":
															  FBPonlineAgents = FBPonlineAgents + 1;
															  if(!FBcounted){
																  TFBonlineAgents = TFBonlineAgents + 1;
																  TFBslots = TFBslots + totalSpots;
																  FBcounted = true;
															  }
															  FBPslots = FBPslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  FBPawayAgents = FBPawayAgents + 1;
															  if(!FBcounted){
																  TFBawayAgents = TFBawayAgents + 1;
																  FBcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  FBPsoonAgents = FBPsoonAgents + 1;
															  if(!FBcounted){  
																  TFBsoonAgents = TFBsoonAgents + 1;
																  FBcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "facebook_risvegliate":
													  switch(statusAgent) {
															  case "ONLINE":
															  FBRonlineAgents = FBRonlineAgents + 1;
															  if(!FBcounted){
																  TFBonlineAgents = TFBonlineAgents + 1;
																  TFBslots = TFBslots + totalSpots;
																  FBcounted = true;
															  }
															  FBRslots = FBRslots + totalSpots;
															  
															  break;
															  case "AWAY":
															  FBRawayAgents = FBRawayAgents + 1;
															  if(!FBcounted){
																  TFBawayAgents = TFBawayAgents + 1;
																  FBcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  FBRsoonAgents = FBRsoonAgents + 1;
															  if(!FBcounted){
																  TFBsoonAgents = TFBsoonAgents + 1;
																  FBcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Facebook_priv_night":
													  switch(statusAgent) {
															  case "ONLINE":
															  FBPNonlineAgents = FBPNonlineAgents + 1;
															  if(!FBcounted){
																  TFBonlineAgents = TFBonlineAgents + 1;
																  TFBslots = TFBslots + totalSpots;
																  FBcounted = true;
															  }
															  FBPNslots = FBPNslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  FBPNawayAgents = FBPNawayAgents + 1;
															  if(!FBcounted){
																  TFBawayAgents = TFBawayAgents + 1;
																  FBcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  FBPNsoonAgents = FBPNsoonAgents + 1;
															  if(!FBcounted){
																  TFBsoonAgents = TFBsoonAgents + 1;
																  FBcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Facebook_priv_night_risvegli":
													  switch(statusAgent) {
															  case "ONLINE":
															  FBPNRonlineAgents = FBPNRonlineAgents + 1;
															  if(!FBcounted){
																  TFBonlineAgents = TFBonlineAgents + 1;
																  TFBslots = TFBslots + totalSpots;
																  FBcounted = true;
															  }
															  FBPNRslots = FBPNRslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  FBPNRawayAgents = FBPNRawayAgents + 1;
															  if(!FBcounted){
																  
																  TFBawayAgents = TFBawayAgents + 1;
																  FBcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  FBPNRsoonAgents = FBPNRsoonAgents + 1;
															  if(!FBcounted){
																  
																  TFBsoonAgents = TFBsoonAgents + 1;
																  FBcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Fixed":
													  switch(statusAgent) {
															  case "ONLINE":
															  FIXonlineAgents = FIXonlineAgents + 1;
															  if(!FBcounted){
																  TFBonlineAgents = TFBonlineAgents + 1;
																  TFBslots = TFBslots + totalSpots;
																  FBcounted = true;
															  }
															  FIXslots = FIXslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  FIXawayAgents = FIXawayAgents + 1;
															  if(!FBcounted){
																  TFBawayAgents = TFBawayAgents + 1;
																  FBcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  FIXsoonAgents = FIXsoonAgents + 1;
															  if(!FBcounted){  
																  TFBsoonAgents = TFBsoonAgents + 1;
																  FBcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Fixed_risvegliata":
													  switch(statusAgent) {
															  case "ONLINE":
															  FIXRonlineAgents = FIXRonlineAgents + 1;
															  if(!FBcounted){
																  TFBonlineAgents = TFBonlineAgents + 1;
																  TFBslots = TFBslots + totalSpots;
																  FBcounted = true;
															  }
															  FIXRslots = FIXRslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  FIXRawayAgents = FIXRawayAgents + 1;
															  if(!FBcounted){
																  TFBawayAgents = TFBawayAgents + 1;
																  FBcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  FIXRsoonAgents = FIXRsoonAgents + 1;
															  if(!FBcounted){  
																  TFBsoonAgents = TFBsoonAgents + 1;
																  FBcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "human":
													  switch(statusAgent) {
															  case "ONLINE":
															  HonlineAgents = HonlineAgents + 1;
															  if(!Hcounted){
																  TWebonlineAgents = TWebonlineAgents + 1;
																  TWebslots = TWebslots + totalSpots;
																  Hcounted = true;
															  }
															  Hslots = Hslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  HawayAgents = HawayAgents + 1;
															  if(!Hcounted){
																  TWebawayAgents = TWebawayAgents + 1;
																  Hcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  HsoonAgents = HsoonAgents + 1;
															  if(!Hcounted){
																  TWebsoonAgents = TWebsoonAgents + 1;
																  Hcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "human_risvegliate":
													  switch(statusAgent) {
															  case "ONLINE":
															  HRonlineAgents = HRonlineAgents + 1;
															  if(!Hcounted){
																  TWebonlineAgents = TWebonlineAgents + 1;
																  TWebslots = TWebslots + totalSpots;
																  Hcounted = true;
															  }
															  HRslots = HRslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  HRawayAgents = HRawayAgents + 1;
															  if(!Hcounted){
																  TWebawayAgents = TWebawayAgents + 1;
																  Hcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  HRsoonAgents = HRsoonAgents + 1;
															  if(!Hcounted){
																  TWebsoonAgents = TWebsoonAgents + 1;
																  Hcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "human_night":
													  switch(statusAgent) {
															  case "ONLINE":
															  HNonlineAgents = HNonlineAgents + 1;
															  if(!Hcounted){
																  TWebonlineAgents = TWebonlineAgents + 1;
																  TWebslots = TWebslots + totalSpots;
																  Hcounted = true;
															  }
															  HNslots = HNslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  HNawayAgents = HNawayAgents + 1;
															  if(!Hcounted){
																  TWebawayAgents = TWebawayAgents + 1;
																  Hcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  HNsoonAgents = HNsoonAgents + 1;
															  if(!Hcounted){
																  TWebsoonAgents = TWebsoonAgents + 1;
																  Hcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "human_night_risvegliate":
													  switch(statusAgent) {
															  case "ONLINE":
															  HNRonlineAgents = HNRonlineAgents + 1;
															  if(!Hcounted){
																  TWebonlineAgents = TWebonlineAgents + 1;
																  TWebslots = TWebslots + totalSpots;
																  Hcounted = true;
															  }
															  HNRslots = HNRslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  HNRawayAgents = HNRawayAgents + 1;
															  if(!Hcounted){
																  TWebawayAgents = TWebawayAgents + 1;
																  Hcounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  HNRsoonAgents = HNRsoonAgents + 1;
															  if(!Hcounted){
																  TWebsoonAgents = TWebsoonAgents + 1;
																  Hcounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Outbound":
													  switch(statusAgent) {
															  case "ONLINE":
															  OonlineAgents = OonlineAgents + 1;
															  if(!Ocounted){
																  TOonlineAgents = TOonlineAgents + 1;
																  TOslots = TOslots + totalSpots;
																  Ocounted = true;
															  }
															  Oslots = Oslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  OawayAgents = OawayAgents + 1;
															  if(!Ocounted){
																  TOawayAgents = TOawayAgents + 1;
																  Ocounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  OsoonAgents = OsoonAgents + 1;
															  if(!Ocounted){
																  TOsoonAgents = TOsoonAgents + 1;
																  Ocounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "outbound_risvegliate":
													  switch(statusAgent) {
															  case "ONLINE":
															  ORonlineAgents = ORonlineAgents + 1;
															  if(!Ocounted){
																  TOonlineAgents = TOonlineAgents + 1;
																  TOslots = TOslots + totalSpots;
																  Ocounted = true;
															  }
															  ORslots = ORslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  ORawayAgents = ORawayAgents + 1;
															  if(!Ocounted){
																  TOawayAgents = TOawayAgents + 1;
																  Ocounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  ORsoonAgents = ORsoonAgents + 1;
															  if(!Ocounted){
																  TOsoonAgents = TOsoonAgents + 1;
																  Ocounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Outbound_fixed":
													  switch(statusAgent) {
															  case "ONLINE":
															  OFonlineAgents = OFonlineAgents + 1;
															  if(!Ocounted){
																  TOonlineAgents = TOonlineAgents + 1;
																  TOslots = TOslots + totalSpots;
																  Ocounted = true;
															  }
															  OFslots = OFslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  OFawayAgents = OFawayAgents + 1;
															  if(!Ocounted){
																  TOawayAgents = TOawayAgents + 1;
																  Ocounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  OFsoonAgents = OFsoonAgents + 1;
															  if(!Ocounted){
																  TOsoonAgents = TOsoonAgents + 1;
																  Ocounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Outbound_fixed_risvegliate":
													  switch(statusAgent) {
															  case "ONLINE":
															  OFRonlineAgents = OFRonlineAgents + 1;
															  if(!Ocounted){
																  TOonlineAgents = TOonlineAgents + 1;
																  TOslots = TOslots + totalSpots;
																  Ocounted = true;
															  }
															  OFRslots = OFRslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  OFRawayAgents = OFRawayAgents + 1;
															  if(!Ocounted){
																  TOawayAgents = TOawayAgents + 1;
																  Ocounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  OFRsoonAgents = OFRsoonAgents + 1;
															  if(!Ocounted){
																  TOsoonAgents = TOsoonAgents + 1;
																  Ocounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Inglese":
													  switch(statusAgent) {
															  case "ONLINE":
															  IonlineAgents = IonlineAgents + 1;
															  if(!Othercounted){
																  TOtheronlineAgents = TOtheronlineAgents + 1;
																  TOtherslots = TOtherslots + totalSpots;
																  Othercounted = true;
															  }
															  Islots = Islots + totalSpots;
															  break;
															  
															  case "AWAY":
															  IawayAgents = IawayAgents + 1;
															  if(!Othercounted){
																  TOtherawayAgents = TOtherawayAgents + 1;
																  Othercounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  IsoonAgents = IsoonAgents + 1;
															  if(!Othercounted){
																  TOthersoonAgents = TOthersoonAgents + 1;
																  Othercounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Inglese_chat":
													  switch(statusAgent) {
															  case "ONLINE":
															  IConlineAgents = IConlineAgents + 1;
															  if(!Othercounted){
																  TOtheronlineAgents = TOtheronlineAgents + 1;
																  TOtherslots = TOtherslots + totalSpots;
																  Othercounted = true;
															  }
															  ICslots = ICslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  ICawayAgents = ICawayAgents + 1;
															  if(!Othercounted){
																  TOtherawayAgents = TOtherawayAgents + 1;
																  Othercounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  ICsoonAgents = ICsoonAgents + 1;
															  if(!Othercounted){
																  TOthersoonAgents = TOthersoonAgents + 1;
																  Othercounted = true;
															  }
															  break;	  
													  }
													  break;
													  
													  case "Priority":
													  switch(statusAgent) {
															  case "ONLINE":
															  PonlineAgents = PonlineAgents + 1;
															  if(!Othercounted){
																  TOtheronlineAgents = TOtheronlineAgents + 1;
																  TOtherslots = TOtherslots + totalSpots;
																  Othercounted = true;
															  }
															  Pslots = Pslots + totalSpots;
															  break;
															  
															  case "AWAY":
															  PawayAgents = PawayAgents + 1;
															  if(!Othercounted){
																  TOtherawayAgents = TOtherawayAgents + 1;
																  Othercounted = true;
															  }
															  break;
															  
															  case "BACK_SOON":
															  PsoonAgents = PsoonAgents + 1;
															  if(!Othercounted){
																  TOthersoonAgents = TOthersoonAgents + 1;
																  Othercounted = true;
															  }
															  break;	  
													  }
													  break;
													  
											  }
											  
											  
										  }
									  }
									  
								  }
							  }
						  }
					  }
				  }
				  document.getElementById("slotsAvailable").innerHTML = "Sessioni disponibili: " + (Math.round(availableSpots * 100) / 100);
				  document.getElementById("slotsAvailable").style = "color : green";
				  document.getElementById("slotsAvailable").style.fontWeight = "bold";
				  document.getElementById("slotsAvailable").style.fontSize = "large";
				  document.getElementById("FBPonlineAgents").innerHTML = FBPonlineAgents;
				  document.getElementById("FBPawayAgents").innerHTML = FBPawayAgents;
				  document.getElementById("FBPsoonAgents").innerHTML = FBPsoonAgents;
				  FBPslots = (Math.round(FBPslots * 100) / 100);
				  document.getElementById("FBPslots").innerHTML = FBPslots;
				  document.getElementById("FBRonlineAgents").innerHTML = FBRonlineAgents;
				  document.getElementById("FBRawayAgents").innerHTML = FBRawayAgents;
				  document.getElementById("FBRsoonAgents").innerHTML = FBRsoonAgents;
				  FBRslots = (Math.round(FBRslots * 100) / 100);
				  document.getElementById("FBRslots").innerHTML = FBRslots;
				  document.getElementById("FBPNonlineAgents").innerHTML = FBPNonlineAgents;
				  document.getElementById("FBPNawayAgents").innerHTML = FBPNawayAgents;
				  document.getElementById("FBPNsoonAgents").innerHTML = FBPNsoonAgents;
				  FBPNslots = (Math.round(FBPNslots * 100) / 100);
				  document.getElementById("FBPNslots").innerHTML = FBPNslots;
				  document.getElementById("FBPNRonlineAgents").innerHTML = FBPNRonlineAgents;
				  document.getElementById("FBPNRawayAgents").innerHTML = FBPNRawayAgents;
				  document.getElementById("FBPNRsoonAgents").innerHTML = FBPNRsoonAgents;
				  FBPNRslots = (Math.round(FBPNRslots * 100) / 100);
				  document.getElementById("FBPNRslots").innerHTML = FBPNRslots;
				  document.getElementById("FIXonlineAgents").innerHTML = FIXonlineAgents;
				  document.getElementById("FIXawayAgents").innerHTML = FIXawayAgents;
				  document.getElementById("FIXsoonAgents").innerHTML = FIXsoonAgents;
				  FIXslots = (Math.round(FIXslots * 100) / 100);
				  document.getElementById("FIXslots").innerHTML = FIXslots;
				  document.getElementById("FIXRonlineAgents").innerHTML = FIXRonlineAgents;
				  document.getElementById("FIXRawayAgents").innerHTML = FIXRawayAgents;
				  document.getElementById("FIXRsoonAgents").innerHTML = FIXRsoonAgents;
				  FIXRslots = (Math.round(FIXRslots * 100) / 100);
				  document.getElementById("FIXRslots").innerHTML = FIXRslots;
				  document.getElementById("HonlineAgents").innerHTML = HonlineAgents;
				  document.getElementById("HawayAgents").innerHTML = HawayAgents;
				  document.getElementById("HsoonAgents").innerHTML = HsoonAgents;
				  Hslots = (Math.round(Hslots * 100) / 100);
				  document.getElementById("Hslots").innerHTML = Hslots;
				  document.getElementById("HRonlineAgents").innerHTML = HRonlineAgents;
				  document.getElementById("HRawayAgents").innerHTML = HRawayAgents;
				  document.getElementById("HRsoonAgents").innerHTML = HRsoonAgents;
				  HRslots = (Math.round(HRslots * 100) / 100);
				  document.getElementById("HRslots").innerHTML = HRslots;
				  document.getElementById("HNonlineAgents").innerHTML = HNonlineAgents;
				  document.getElementById("HNawayAgents").innerHTML = HNawayAgents;
				  document.getElementById("HNsoonAgents").innerHTML = HNsoonAgents;
				  HNslots = (Math.round(HNslots * 100) / 100);
				  document.getElementById("HNslots").innerHTML = HNslots;
				  document.getElementById("HNRonlineAgents").innerHTML = HNRonlineAgents;
				  document.getElementById("HNRawayAgents").innerHTML = HNRawayAgents;
				  document.getElementById("HNRsoonAgents").innerHTML = HNRsoonAgents;
				  HNRslots = (Math.round(HNRslots * 100) / 100);
				  document.getElementById("HNRslots").innerHTML = HNRslots;
				  document.getElementById("OonlineAgents").innerHTML = OonlineAgents;
				  document.getElementById("OawayAgents").innerHTML = OawayAgents;
				  document.getElementById("OsoonAgents").innerHTML = OsoonAgents;
				  Oslots = (Math.round(Oslots * 100) / 100);
				  document.getElementById("Oslots").innerHTML = Oslots;
				  document.getElementById("ORonlineAgents").innerHTML = ORonlineAgents;
				  document.getElementById("ORawayAgents").innerHTML = ORawayAgents;
				  document.getElementById("ORsoonAgents").innerHTML = ORsoonAgents;
				  ORslots = (Math.round(ORslots * 100) / 100);
				  document.getElementById("ORslots").innerHTML = ORslots;
				  document.getElementById("OFonlineAgents").innerHTML = OFonlineAgents;
				  document.getElementById("OFawayAgents").innerHTML = OFawayAgents;
				  document.getElementById("OFsoonAgents").innerHTML = OFsoonAgents;
				  OFslots = (Math.round(OFslots * 100) / 100);
				  document.getElementById("OFslots").innerHTML = OFslots;
				  document.getElementById("OFRonlineAgents").innerHTML = OFRonlineAgents;
				  document.getElementById("OFRawayAgents").innerHTML = OFRawayAgents;
				  document.getElementById("OFRsoonAgents").innerHTML = OFRsoonAgents;
				  OFRslots = (Math.round(OFRslots * 100) / 100);
				  document.getElementById("OFRslots").innerHTML = OFRslots;
				  document.getElementById("IonlineAgents").innerHTML = IonlineAgents;
				  document.getElementById("IawayAgents").innerHTML = IawayAgents;
				  document.getElementById("IsoonAgents").innerHTML = IsoonAgents;
				  Islots = (Math.round(Islots * 100) / 100);
				  document.getElementById("Islots").innerHTML = Islots;
				  document.getElementById("IConlineAgents").innerHTML = IConlineAgents;
				  document.getElementById("ICawayAgents").innerHTML = ICawayAgents;
				  document.getElementById("ICsoonAgents").innerHTML = ICsoonAgents;
				  ICslots = (Math.round(ICslots * 100) / 100);
				  document.getElementById("ICslots").innerHTML = ICslots;
				  document.getElementById("PonlineAgents").innerHTML = PonlineAgents;
				  document.getElementById("PawayAgents").innerHTML = PawayAgents;
				  document.getElementById("PsoonAgents").innerHTML = PsoonAgents;
				  Pslots = (Math.round(Pslots * 100) / 100);
				  document.getElementById("Pslots").innerHTML = Pslots;
				  document.getElementById("TFBonlineAgents").innerHTML = TFBonlineAgents;
				  document.getElementById("TWebonlineAgents").innerHTML = TWebonlineAgents;
				  document.getElementById("TOonlineAgents").innerHTML = TOonlineAgents;
				  document.getElementById("TOtheronlineAgents").innerHTML = TOtheronlineAgents;
				  document.getElementById("TFBawayAgents").innerHTML = TFBawayAgents;
				  document.getElementById("TWebawayAgents").innerHTML = TWebawayAgents;
				  document.getElementById("TOawayAgents").innerHTML = TOawayAgents;
				  document.getElementById("TOtherawayAgents").innerHTML = TOtherawayAgents;
				  document.getElementById("TFBsoonAgents").innerHTML = TFBsoonAgents;
				  document.getElementById("TWebsoonAgents").innerHTML = TWebsoonAgents;
				  document.getElementById("TOsoonAgents").innerHTML = TOsoonAgents;
				  document.getElementById("TOthersoonAgents").innerHTML = TOthersoonAgents;
				  document.getElementById("TFBslots").innerHTML = (Math.round(TFBslots * 100) / 100);
				  document.getElementById("TWebslots").innerHTML = (Math.round(TWebslots * 100) / 100);
				  document.getElementById("TOslots").innerHTML = (Math.round(TOslots * 100) / 100);
				  document.getElementById("TOtherslots").innerHTML = (Math.round(TOtherslots * 100) / 100);
				  
	  
	  
	  
			  },
			  error: function error(e, text) {
				  localStorage.setItem('account_number', '');
				  location.reload();
			  },
			  beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		  });
                       
	}, 3000);
	
	
}
	
	
	
	
  function loadLimboBar(){
	  
	 var howManyLimbo = 0; 
	 var howManyUnassigned = 0;
	 var body = body = '{"start":{"from":' + (Date.now() - (1000*60*60*24*30)) + ',"to":' + (Date.now()) + '}, "status": ["OPEN"]}';
	 var offset = 0;
	  
	 $.ajax({
                              url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=" + offset + "&limit=100",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: body,
                              success: function success(data) {
				      herokuOrNot();
				      botOrNot();
				      if((data._metadata.count) > 0){
					      var length = data.conversationHistoryRecords.length;
					      for (var m = 0; m < length; m++){
						      if((data.conversationHistoryRecords[m].info.latestSkillName) === "Limbo"){
							      howManyLimbo = howManyLimbo + 1;
						      }
						      else{
							      if((data.conversationHistoryRecords[m].info.latestAgentLoginName) === "NA"){
								      howManyUnassigned = howManyUnassigned + 1;
							      }   
						      }
					      }
				      }
				      document.getElementById("limbo").innerHTML = howManyLimbo;
				      document.getElementById("unassigned").innerHTML = howManyUnassigned;
                              },
                              error: function error(e, text) {
		 
                              },
                              beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		});
	  
  }
	
  function loadBar(){
	  
	  setTimeout(function(){
		  
	      	$.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/facadeMsg/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
			loadLimboBar();
                        if('lpCallError' in data.ResultSet){
				localStorage.setItem('account_number', '');
			   	location.reload(); 
                        }
                        else{
                           	facadeUri = data.ResultSet.lpData[0].lpServer;
                           	$.ajax({
                              		url: "https://" + facadeUri + "/api/messaging/rest/reporting/brands/" + accnumb + "/msgstatistics?v=1",
                              		method: "GET",
                              		jsonp: "cb",
                              		jsonpCallback: "domainCallback",
                              		cache: true,
                              		contentType: "application/json",
                              		success: function success(data) {
						document.getElementById("open").innerHTML = data.active;
						document.getElementById("pending").innerHTML = data.pending;
						document.getElementById("overdue").innerHTML = data.overdue;
						document.getElementById("soonOverdue").innerHTML = data.soonToOverdue;
                              		},
                              		error: function error(e, text) {
						localStorage.setItem('account_number', '');
				    		location.reload(); 
                              		},
                              		beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          	});   
                        }
                    },
                    error: function error(e, text) {
			    console.log(text);
			    localStorage.setItem('account_number', '');
			    location.reload(); 
                    }
              	});
	}, 1000);
  }
	
  function loadSkills(){
	  
	  setTimeout(function(){
		  
	      	$.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/accountConfigReadWrite/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
				localStorage.setItem('account_number', '');
			   	location.reload(); 
                        }
                        else{
                           	accountReadWrite = data.ResultSet.lpData[0].lpServer;
                           	$.ajax({
                              		url: "https://" + accountReadWrite + "/api/account/" + accnumb + "/configuration/le-users/skills",
                              		method: "GET",
                              		jsonp: "cb",
                              		jsonpCallback: "domainCallback",
                              		cache: true,
                              		contentType: "application/json",
                              		success: function success(data) {
						skillArray = data;
						var appendSkill = '<select name="skillSelector" id="skillName"><option>All</option>';
						var toAppend = '';
						var newHuman = '';
						var toAppendHuman = '';
						var length = data.length;
						for (var m = 0; m < length; m++){
							if(!data[m].name.startsWith("***")){
								toAppend = '<option>' + data[m].name + '</option>';
								appendSkill = appendSkill.concat(toAppend);
							}
							else{
								toAppendHuman = '","' + data[m].id;
								newHuman = newHuman.concat(toAppendHuman);
							}
						}
						// console.log("*****");
						// console.log("*****");
						// console.log(newHuman);
						// console.log("*****");
						// console.log("*****");
						overwriteHumanSkill = newHuman;
						appendSkill = appendSkill.concat('</select>');
						$("#skill").append(appendSkill);
						$('#customDate').val($('#startdate').val());
						$('#endCustomDate').val($('#enddate').val());
						$('#customHour').val("00:00");
						$('#endCustomHour').val("23:59");
						var thisDate = $('#customDate').val();
						thisDate = new Date(thisDate);
						var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
						var year = thisDate.getFullYear();
						var month = months[thisDate.getMonth()];
						var date = thisDate.getDate();
						var hour = $('#customHour').val();
						thisDate = month + " " + date + " " + year + " " + hour + timeZone;
						var d = new Date(thisDate);
						customDate = d.getTime();
						thisDate = $('#endCustomDate').val();
						thisDate = new Date(thisDate);
						months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
						year = thisDate.getFullYear();
						month = months[thisDate.getMonth()];
						date = thisDate.getDate();
						hour = $('#endCustomHour').val();
						thisDate = month + " " + date + " " + year + " " + hour + timeZone;
						d = new Date(thisDate);
						endCustomDate = d.getTime();
						
						$('#customDate,#customHour').on('change', function() {
							
							var thisDate = $('#customDate').val();
							thisDate = new Date(thisDate);
							var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
							var year = thisDate.getFullYear();
							var month = months[thisDate.getMonth()];
							var date = thisDate.getDate();
							var hour = $('#customHour').val();
							thisDate = month + " " + date + " " + year + " " + hour + timeZone;
							var d = new Date(thisDate);
							customDate = d.getTime();
						})
						$('#endCustomDate,#endCustomHour').on('change', function() {
							
							var thisDate = $('#endCustomDate').val();
							thisDate = new Date(thisDate);
							var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
							var year = thisDate.getFullYear();
							var month = months[thisDate.getMonth()];
							var date = thisDate.getDate();
							var hour = $('#endCustomHour').val();
							thisDate = month + " " + date + " " + year + " " + hour + timeZone;
							var d = new Date(thisDate);
							endCustomDate = d.getTime();
							
						})
                              		},
                              		error: function error(e, text) {
						localStorage.setItem('account_number', '');
				    		location.reload(); 
                              		},
                              		beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          	});   
                        }
                    },
                    error: function error(e, text) {
			    console.log(text);
			    localStorage.setItem('account_number', '');
			    location.reload(); 
                    }
              	});
	}, 2000);
  }
	
  function loadTeams(){
	  
	  setTimeout(function(){
		  
		  $.ajax({
			  url: "https://" + accountReadWrite + "/api/account/" + accnumb + "/configuration/le-users/agentGroups",
			  method: "GET",
			  jsonp: "cb",
			  jsonpCallback: "domainCallback",
			  cache: true,
			  contentType: "application/json",
			  "If-Match": "-1",
			  success: function success(data) {
				  teamArray = data;
				  var appendTeam = '<select name="teamSelector" id="teamName"><option>All</option>';
				  var toAppend = '';
				  var length = data.length;
				  for (var m = 0; m < length; m++){
					  toAppend = '<option>' + data[m].name + '</option>';
					  appendTeam = appendTeam.concat(toAppend);
				  }
				  appendTeam = appendTeam.concat('</select>');
				  $("#team").append(appendTeam);
				  buildAlbero(data);
			  },
			  error: function error(e, text) {
				  localStorage.setItem('account_number', '');
				  location.reload();
			  },
			  beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		  });
                       
	}, 3000);
  }
	
	
	
	
	
  function buildAlbero(agentJSON){
	  
	  var length = agentJSON.length;
	  var groupID;
	  var nameGroupFather;
	  console.log("*********************");
	  console.log("*** Albero Gruppi ***");
	  console.log("*********************");
	  for (var p = 0; p < length; p++){
		  
		  groupID = agentJSON[p].id;
		  
		  if (groupID < 0){
			  var newElementAlbero = '{"son":"Main Group","father":"Main Group"}';
			  newElementAlbero = JSON.parse(newElementAlbero);
			  alberoArray.push(newElementAlbero);
		  }
		  else{
		  
		  	$.ajax({
			  	url: "https://" + accountReadWrite + "/api/account/" + accnumb + "/configuration/le-users/agentGroups/" + groupID,
			  	method: "GET",
			  	jsonp: "cb",
			  	jsonpCallback: "domainCallback",
			  	cache: true,
			  	contentType: "application/json",
			  	"If-Match": "-1",
			  	success: function success(data) {
				  	for (var v = 0; v < length; v++){
					  	if (agentJSON[v].id === data.parentGroupId){
						  	nameGroupFather = agentJSON[v].name;
						  	var newElementAlbero = '{"son":"' + data.name + '","father":"' + nameGroupFather + '"}';
						  	newElementAlbero = JSON.parse(newElementAlbero);
						  	alberoArray.push(newElementAlbero);
					  	}
				  	}
				  	console.log(data.name + "*****" + nameGroupFather);
			  	},
			  	error: function error(e, text) {
				  	localStorage.setItem('account_number', '');
				  	location.reload();
			  	},
			  	beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		  	});
		  }
	  }
	  $("#downloadTranscripts").prop( "disabled", false );
	  setTimeout(function(){ console.log(alberoArray); }, 5000);
                       
	
  }
	
	
  function loadAggregate(){
	 
	var end = Date.now();
	var start = end - (1000*60*60*24*30);  // loading Convs started till 30 days ago
	var offset = 0;
	  
	
	 

	 function loadMyAggregate(start, end, offset, callback) {
		 
		 var body = '{"start":{"from":' + start + ',"to":' + end + '}, "aggregateBy":["latestSkillIds","latestConversationQueueState"], "status": ["OPEN"], "skillIds":["' + mySkillsToLoad[offset] + '"]}';
	 
	 
	 	$.ajax({
                              url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/aggregations",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: body,
                              success: function success(data) {
				      
				      var myActualSkill = mySkillsToLoad[offset];
				      var actualID = ""
				      var actualValue;
				      
				      console.log(data);
				      
				      if(data._metadata.count > 0){
					      
					      var mycount = 0;
					      
					      actualValue = data.aggregations[0].count;
					      actualID = myActualSkill + "openConv";
					      document.getElementById(actualID).innerHTML = actualValue;
					      if(data.aggregations[0].aggregatedBy !== "latestConversationQueueState"){
						      mycount = 1;
					      }
					      if(data.aggregations[mycount].buckets[0].key === "IN_QUEUE"){
						      actualValue = data.aggregations[mycount].buckets[0].count;
						      actualID = myActualSkill + "unassignedConv";
						      document.getElementById(actualID).innerHTML = actualValue;
						      if(data.aggregations[mycount].buckets.length > 1){
							      actualValue = data.aggregations[mycount].buckets[1].count;
							      actualID = myActualSkill + "assignedConv";
							      document.getElementById(actualID).innerHTML = actualValue;
						      } else{
							      actualID = myActualSkill + "assignedConv";
							      document.getElementById(actualID).innerHTML = "0";
						      }
					      } else{
						      actualValue = data.aggregations[mycount].buckets[0].count;
						      actualID = myActualSkill + "assignedConv";
						      document.getElementById(actualID).innerHTML = actualValue;
						      if(data.aggregations[mycount].buckets.length > 1){
							      actualValue = data.aggregations[mycount].buckets[1].count;
							      actualID = myActualSkill + "unassignedConv";
							      document.getElementById(actualID).innerHTML = actualValue;
						      } else{
							      actualID = myActualSkill + "unassignedConv";
							      document.getElementById(actualID).innerHTML = "0";
						      }
					      }


					      
					      
				      } else{
					      actualID = myActualSkill + "openConv";
					      document.getElementById(actualID).innerHTML = "0";
					      actualID = myActualSkill + "assignedConv";
					      document.getElementById(actualID).innerHTML = "0";
					      actualID = myActualSkill + "unassignedConv";
					      document.getElementById(actualID).innerHTML = "0";
					      
				      }
				      
				      
				      
				      
				      offset = offset + 1;
				      if(mySkillsToLoadLength > offset){
					      
						      
					      
					      
					      console.log("done with this call!");

					      document.getElementById("loaderMSG").innerHTML = "...downloading sessions:" + Math.round(100*(offset/mySkillsToLoadLength)) + "% completed...";
					      document.getElementById("loaderMSG").style = "color : green";
					      loadMyAggregate(start, end, offset, callback);
				      }
				      else{
					      $('#loadingStats').css('display', 'none');
					      $('#loadedStats').css('display', 'inline');
	  
				      }
				      
     
				      
                              },
                              error: function error(e, text) {
				      location.reload();
                              },
                              beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		});
	 }
	  
	 setTimeout(function(){
	 	loadMyAggregate(start, end, offset, function(err, resp) {
		 	// Your code here...
	 	});
	 }, 3000);


	 
 }
		
  
  function checklogin(accnumb, bearer){	
	$('#myloader').css('display', 'inline');
  	if(!((accnumb === null) || (accnumb === '') || (bearer === null) || (bearer === ''))){
    		$.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/msgHist/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
				localStorage.setItem('account_number', '');
			   	location.reload(); 
                        }
                        else{
                           	uri = data.ResultSet.lpData[0].lpServer;
				console.log(data);
                           	console.log(uri);
                           	$.ajax({
                              		url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=0&limit=50",
                              		method: "POST",
                              		jsonp: "cb",
                              		jsonpCallback: "domainCallback",
                              		cache: true,
                              		contentType: "application/json",
                              		data: '{\"start":{\"from\":' + (new Date().getTime()-5000) + ',\"to\":'+ new Date().getTime() + '}}',
                              		success: function success(data) {
						$('#myloader').css('display', 'none');
          					$('#myreports').css('display', 'inline');
						retrieveAgentsLogged();  // loads also the conversations
						setInterval(function(){
							loadBar();
						}, 30000);
						loadBar();
						loadSkills();
						loadTeams();
						$('#loadedStats').css('display', 'none');
						$('#loadingStats').css('display', 'inline');	
                              		},
                              		error: function error(e, text) {
						localStorage.setItem('account_number', '');
				    		location.reload(); 
                              		},
                              		beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          	});   
                        }
                    },
                    error: function error(e, text) {
			    console.log(text);
			    localStorage.setItem('account_number', '');
			    location.reload(); 
                    }
              	});
  	  }
	  else{
		  $('#myloader').css('display', 'none');
		  $('#mylogin').css('display', 'inline');
	  }
  }
	
	
checklogin(accnumb, bearer);
	
	 
		
  
	
	
  $(document).on('click', function(evt) {
	  if($(evt.target).is('#logout')) {
		  $('#myreports').css('display', 'none');
		  $('#myloader').css('display', 'inline');
		  setTimeout(function(){
			  localStorage.setItem('account_number', '');
			  location.reload();
		  }, 2000);
	  }
	  if($(evt.target).is('#refresh')) {
		retrieveAgentsLogged();  // loads also the conversations
		  
		document.getElementById("loaderMSG").innerHTML = "Refreshing data!";
		document.getElementById("loaderMSG").style = "color : green";
		  
		$('#loadedStats').css('display', 'none');
		$('#loadingStats').css('display', 'inline');	
		  							
	  }
  });
		  	
  
  $(document).on('click', function(evt) {
	  if($("#accnumb").val() != ""){
		  if($(evt.target).is('#submitLogin')) {			  
			  uname = $("#uname").val();
			  localStorage.setItem('username', uname);
			  pwd = $("#pwd").val();
			  accnumb = $("#accnumb").val();
			  console.log(accnumb + " *** " + uname + " *** " + pwd);
			  $.ajax({
				  url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/agentVep/baseURI.lpCsds?version=1.0",
				  jsonp: "cb",
				  jsonpCallback: "domainCallback",
				  cache: true,
				  dataType: "jsonp",
				  success: function success(data) {
					  if('lpCallError' in data.ResultSet){
						  document.getElementById("sendStat").innerHTML = "Please insert a correct login!";
						  document.getElementById("sendStat").style = "color : red";
					  }
					  else{
						  uri = data.ResultSet.lpData[0].lpServer;
						  console.log(uri);
						  $.ajax({
							  url: "https://" + uri + "/api/account/" + accnumb + "/login?v=1.3",
							  method: "POST",
							  jsonp: "cb",
							  jsonpCallback: "domainCallback",
							  cache: true,
							  contentType: "application/json",
							  data: '{"username":"' + uname + '","password":"' + pwd +'"}',
							  success: function success(data) {
								  csrf = data.csrf;
								  bearer = data.bearer;
								  localStorage.setItem('account_number', accnumb);
								  localStorage.setItem('csrf', csrf);
								  localStorage.setItem('bearer', bearer);
								  $('#mylogin').css('display', 'none');
								  $('#myloader').css('display', 'inline');
								  setTimeout(function(){
									  $('#myloader').css('display', 'none');
									  $('#myreports').css('display', 'inline');
									  retrieveAgentsLogged();  // loads also the conversations
									  loadBar();
									  loadSkills();
									  loadTeams();
									  
									  $('#loadedStats').css('display', 'none');
									  $('#loadingStats').css('display', 'inline');  
									  
								  }, 2000);
							  },
							  error: function error(e, text) {
								  document.getElementById("sendStat").innerHTML = "Please insert a correct login!";
								  document.getElementById("sendStat").style = "color : red";
							  }
						  });
						  return data;
					  }
				  },
				  error: function error(e, text) {
					  console.log(text);
					  return e;
				  }
			  });
		  }
	  }
  });
    
  
    

	

   
    
</script>
    
    


</body>
</html>
